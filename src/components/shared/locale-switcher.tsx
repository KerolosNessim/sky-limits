"use client";

import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger
} from "@/components/ui/dropdown-menu";
import { useLocale } from "next-intl";
import { usePathname, useRouter } from "next/navigation";
import { useTransition } from "react";
import ReactCountryFlag from "react-country-flag";

const LocaleSwitcher = () => {
  const router = useRouter();
  const pathname = usePathname();
  const locale = useLocale();
  const [isPending, startTransition] = useTransition();

  const toggleLocale = (locale: string) => {
    const newLocale = locale ;

    startTransition(() => {
      const segments = pathname.split("/");
      segments[1] = newLocale;
      router.push(segments.join("/"));
    });
  };

  return (
    <DropdownMenu >
      <DropdownMenuTrigger disabled={isPending}>
        <svg
          width="28"
          height="28"
          viewBox="0 0 28 28"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
          className="size-6"
        >
          <path
            d="M22.0713 15.458C22.6463 15.458 23.1294 15.4585 23.5254 15.4902C23.9397 15.5235 24.3325 15.5952 24.707 15.7803C25.3959 16.1207 25.9379 16.702 26.249 17.4092C26.4158 17.7883 26.4811 18.1855 26.5117 18.6143C26.5413 19.028 26.542 19.5347 26.542 20.1484V20.2119C26.542 20.8257 26.5413 21.3323 26.5117 21.7461C26.4811 22.1748 26.4157 22.5721 26.249 22.9512C25.9379 23.6584 25.3959 24.2396 24.707 24.5801C24.3325 24.7652 23.9398 24.8369 23.5254 24.8701C23.1294 24.9019 22.6463 24.9024 22.0713 24.9023H20.8574C20.1025 24.9023 19.9126 24.9121 19.7422 24.9668C19.5691 25.0223 19.4012 25.1287 18.7734 25.5723L18.6523 25.6582C18.6362 25.6696 18.6196 25.681 18.6035 25.6924C18.2468 25.9446 17.901 26.1894 17.6025 26.3389C17.2903 26.4951 16.7572 26.6863 16.21 26.376C15.6841 26.0777 15.5524 25.5426 15.5049 25.2021C15.4578 24.8649 15.4579 24.4311 15.458 23.9717V21.2207C15.458 20.1049 15.4584 19.1846 15.5508 18.4561C15.6474 17.6946 15.8579 17.0104 16.3799 16.457C16.9088 15.8965 17.5743 15.6634 18.3164 15.5576C19.0137 15.4583 19.8909 15.458 20.9365 15.458H22.0713ZM2.33301 13.125C2.81625 13.125 3.208 13.5168 3.20801 14C3.20801 14.911 3.33459 15.7914 3.57031 16.625H8.56543C8.52669 16.1596 8.49832 15.6836 8.48047 15.1992C8.46268 14.7164 8.83944 14.3099 9.32227 14.292C9.80519 14.2742 10.2117 14.6518 10.2295 15.1348C10.2483 15.6454 10.2796 16.143 10.3223 16.625H12.833C13.3162 16.625 13.708 17.0168 13.708 17.5C13.708 17.9832 13.3163 18.375 12.833 18.375H10.5361C10.7276 19.5799 10.994 20.6405 11.3115 21.499C11.6024 22.2855 11.9196 22.8555 12.2236 23.2129C12.5308 23.574 12.7393 23.6249 12.833 23.625C13.3162 23.625 13.708 24.0168 13.708 24.5C13.708 24.9832 13.3163 25.375 12.833 25.375C7.87912 25.3749 3.66663 22.2086 2.10547 17.792C1.6859 16.6049 1.45801 15.3279 1.45801 14C1.45802 13.5169 1.84992 13.1252 2.33301 13.125ZM21 17.208C19.8741 17.208 19.1228 17.2104 18.5635 17.29C18.0348 17.3654 17.8078 17.4945 17.6533 17.6582C17.492 17.8291 17.3614 18.0906 17.2871 18.6758C17.2103 19.2813 17.208 20.0902 17.208 21.2793V23.915C17.208 24.1659 17.2086 24.367 17.2119 24.5303C17.3357 24.446 17.4765 24.3468 17.6426 24.2295L17.7637 24.1436C17.7932 24.1227 17.8227 24.1015 17.8516 24.0811C18.3489 23.7291 18.7457 23.4479 19.207 23.2998C19.671 23.1509 20.1536 23.1518 20.752 23.1523H22.0371C22.6557 23.1523 23.068 23.1515 23.3857 23.126C23.693 23.1013 23.8374 23.0573 23.9316 23.0107C24.2371 22.8598 24.4949 22.5937 24.6475 22.2471C24.6992 22.1294 24.7426 21.9579 24.7666 21.6221C24.7912 21.2781 24.792 20.8337 24.792 20.1807C24.792 19.5276 24.7912 19.0832 24.7666 18.7393C24.7426 18.4032 24.6992 18.231 24.6475 18.1133C24.4949 17.7667 24.2371 17.5006 23.9316 17.3496C23.8374 17.3031 23.693 17.259 23.3857 17.2344C23.068 17.2089 22.6557 17.208 22.0371 17.208H21ZM4.25781 18.375C5.45792 20.7226 7.59336 22.5116 10.1719 23.2519C9.98844 22.8995 9.82109 22.5142 9.66992 22.1055C9.28211 21.0569 8.9741 19.7874 8.76562 18.375H4.25781ZM15.1826 2.625C20.1366 2.625 24.3489 5.79135 25.9102 10.208C26.2628 11.2056 26.4797 12.2673 26.54 13.3691C26.5663 13.8514 26.1971 14.2634 25.7148 14.29C25.2324 14.3165 24.8196 13.9472 24.793 13.4648C24.7535 12.7439 24.6346 12.0443 24.4453 11.375H19.4502C19.5048 12.0309 19.5391 12.7081 19.5518 13.4004C19.5606 13.8835 19.1765 14.2831 18.6934 14.292C18.2102 14.3008 17.8116 13.9158 17.8027 13.4326C17.7898 12.7224 17.7527 12.0342 17.6943 11.375H15.1826C14.6994 11.375 14.3076 10.9832 14.3076 10.5C14.3076 10.0167 14.6994 9.625 15.1826 9.625H17.4795C17.301 8.50128 17.0569 7.50207 16.7666 6.6748C16.4709 5.83232 16.1436 5.21534 15.8252 4.82617C15.5012 4.43015 15.2795 4.375 15.1826 4.375C14.6994 4.375 14.3076 3.98325 14.3076 3.5C14.3076 3.01675 14.6994 2.625 15.1826 2.625ZM7.06348 1.458C8.10911 1.45796 8.98628 1.45827 9.68359 1.55761C10.4257 1.66335 11.0912 1.89647 11.6201 2.45703C12.1421 3.01038 12.3526 3.69457 12.4492 4.45605C12.5416 5.18461 12.542 6.10491 12.542 7.2207V9.97168C12.5421 10.4311 12.5422 10.8649 12.4951 11.2021C12.4476 11.5426 12.3159 12.0777 11.79 12.376C11.2428 12.6863 10.7097 12.4951 10.3975 12.3389C10.099 12.1894 9.75322 11.9446 9.39648 11.6924C9.38041 11.681 9.36377 11.6696 9.34766 11.6582L9.22656 11.5723C8.59882 11.1287 8.43089 11.0223 8.25781 10.9668C8.08743 10.9121 7.89751 10.9023 7.14258 10.9023H5.92871C5.3537 10.9024 4.87063 10.9019 4.47461 10.8701C4.06023 10.8369 3.66753 10.7652 3.29297 10.5801C2.60411 10.2396 2.06213 9.65839 1.75098 8.95117C1.58427 8.57209 1.51891 8.17477 1.48828 7.74609C1.45873 7.33233 1.458 6.82567 1.45801 6.21191V6.14843C1.458 5.53467 1.45872 5.02801 1.48828 4.61425C1.51891 4.18554 1.58424 3.78828 1.75098 3.40918C2.06213 2.70196 2.60411 2.12072 3.29297 1.78027C3.66752 1.5952 4.06025 1.52349 4.47461 1.49023C4.87063 1.45847 5.3537 1.45799 5.92871 1.458H7.06348ZM5.96289 3.208C5.34434 3.208 4.93199 3.20888 4.61426 3.23437C4.30701 3.25903 4.16257 3.30305 4.06836 3.34961C3.7629 3.50057 3.50506 3.76669 3.35254 4.11328C3.30076 4.23096 3.25741 4.40316 3.2334 4.73925C3.20884 5.08325 3.20801 5.5276 3.20801 6.18066C3.20801 6.83373 3.20882 7.2781 3.2334 7.62207C3.25742 7.95785 3.30079 8.12944 3.35254 8.24707C3.50506 8.5937 3.76288 8.85976 4.06836 9.01074C4.16257 9.0573 4.30696 9.10131 4.61426 9.12597C4.93199 9.15147 5.34433 9.15234 5.96289 9.15234H7.24805C7.84638 9.15185 8.32896 9.1509 8.79297 9.2998C9.2543 9.4479 9.65111 9.72907 10.1484 10.0811C10.1773 10.1015 10.2068 10.1227 10.2363 10.1436L10.3574 10.2295C10.5235 10.3468 10.6643 10.446 10.7881 10.5303C10.7914 10.367 10.792 10.1659 10.792 9.91504V7.27929C10.792 6.09016 10.7897 5.2813 10.7129 4.67578C10.6386 4.09056 10.508 3.82914 10.3467 3.6582C10.1922 3.49445 9.96522 3.36537 9.43652 3.29004C8.87718 3.21038 8.12588 3.208 7 3.208H5.96289ZM17.8438 4.74804C18.0565 5.15676 18.2476 5.61041 18.418 6.0957C18.7714 7.10285 19.0545 8.3004 19.25 9.625H23.7588C22.5587 7.27728 20.4224 5.4884 17.8438 4.74804Z"
            fill="currentColor"
          />
        </svg>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="text-primary text-base!">
        <DropdownMenuItem onClick={() => toggleLocale("en")}>
          <ReactCountryFlag
            countryCode="US"
            svg
            className=" rounded-full object-cover"
          />
          English
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => toggleLocale("ar")}>
          <ReactCountryFlag
            countryCode="SA"
            svg
            className="rounded-full object-cover"
          />
          Arabic
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
};

export default LocaleSwitcher;
